/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */
import{g as o,c as n,f as t}from"./p-dbb71e2b.js";import{a as i,b as e,r,c as a}from"./p-2e15200d.js";import{w as s}from"./p-4de71892.js";import"./p-e1bc9a81.js";var d;!function(o){o.Body="body",o.Ionic="ionic",o.Native="native",o.None="none"}(d||(d={}));const c={getEngine(){var o;return(null===(o=null==s?void 0:s.Capacitor)||void 0===o?void 0:o.isPluginAvailable("Keyboard"))&&(null==s?void 0:s.Capacitor.Plugins.Keyboard)},getResizeMode(){const o=this.getEngine();return o&&o.getResizeMode?o.getResizeMode():Promise.resolve(void 0)}},l=new WeakMap,u=(o,n,t,i=0,e=!1)=>{l.has(o)!==t&&(t?f(o,n,i,e):w(o,n))},f=(o,n,t,i=!1)=>{const e=n.parentNode,r=n.cloneNode(!1);r.classList.add("cloned-input"),r.tabIndex=-1,i&&(r.disabled=!0),e.appendChild(r),l.set(o,r);const a="rtl"===o.ownerDocument.dir?9999:-9999;o.style.pointerEvents="none",n.style.transform=`translate3d(${a}px,${t}px,0) scale(0)`},w=(o,n)=>{const t=l.get(o);t&&(l.delete(o),t.remove()),o.style.pointerEvents="",n.style.transform=""},p="input, textarea, [no-blur], [contenteditable]",m="$ionPaddingTimer",b=(o,n,t)=>{const i=o[m];i&&clearTimeout(i),n>0?o.style.setProperty("--keyboard-offset",`${n}px`):o[m]=setTimeout((()=>{o.style.setProperty("--keyboard-offset","0px"),t&&t()}),120)},y=(o,n,t)=>{o.addEventListener("focusout",(()=>{n&&b(n,0,t)}),{once:!0})};let h=0;const v=async(t,i,e,a,s,d,c=!1)=>{if(!e&&!a)return;const l=((o,n,t)=>{var i;return((o,n,t,i)=>{const e=o.top,r=o.bottom,a=n.top,s=a+15,d=Math.min(n.bottom,i-t)-50-r,c=s-e,l=Math.round(d<0?-d:c>0?-c:0),u=Math.min(l,e-a),f=Math.abs(u);return{scrollAmount:u,scrollDuration:Math.min(400,Math.max(150,f/.3)),scrollPadding:t,inputSafeY:4-(e-s)}})((null!==(i=o.closest("ion-item,[ion-item]"))&&void 0!==i?i:o).getBoundingClientRect(),n.getBoundingClientRect(),t,o.ownerDocument.defaultView.innerHeight)})(t,e||a,s);if(e&&Math.abs(l.scrollAmount)<4)return i.focus(),void(d&&null!==e&&(h+=l.scrollPadding,b(e,h),y(i,e,(()=>h=0))));if(u(t,i,!0,l.inputSafeY,c),i.focus(),r((()=>t.click())),d&&e&&(h+=l.scrollPadding,b(e,h)),"undefined"!=typeof window){let r;const a=async()=>{void 0!==r&&clearTimeout(r),window.removeEventListener("ionKeyboardDidShow",s),window.removeEventListener("ionKeyboardDidShow",a),e&&await n(e,0,l.scrollAmount,l.scrollDuration),u(t,i,!1,l.inputSafeY),i.focus(),d&&y(i,e,(()=>h=0))},s=()=>{window.removeEventListener("ionKeyboardDidShow",s),window.addEventListener("ionKeyboardDidShow",a)};if(e){const n=await o(e);if(l.scrollAmount>n.scrollHeight-n.clientHeight-n.scrollTop)return"password"===i.type?(l.scrollAmount+=50,window.addEventListener("ionKeyboardDidShow",s)):window.addEventListener("ionKeyboardDidShow",a),void(r=setTimeout(a,1e3))}a()}},S=async(o,n)=>{const r=document,s="ios"===n,l="android"===n,f=o.getNumber("keyboardHeight",290),w=o.getBoolean("scrollAssist",!0),m=o.getBoolean("hideCaretOnScroll",s),b=o.getBoolean("inputBlurring",s),y=o.getBoolean("scrollPadding",!0),h=Array.from(r.querySelectorAll("ion-input, ion-textarea")),S=new WeakMap,M=new WeakMap,g=await c.getResizeMode(),D=async o=>{await new Promise((n=>a(o,n)));const n=o.shadowRoot||o,r=n.querySelector("input")||n.querySelector("textarea"),s=t(o),c=s?null:o.closest("ion-footer");if(r){if(s&&m&&!S.has(o)){const n=((o,n,t)=>{if(!t||!n)return()=>{};const r=t=>{var i;(i=n)===i.getRootNode().activeElement&&u(o,n,t)},a=()=>u(o,n,!1),s=()=>r(!0),d=()=>r(!1);return i(t,"ionScrollStart",s),i(t,"ionScrollEnd",d),n.addEventListener("blur",a),()=>{e(t,"ionScrollStart",s),e(t,"ionScrollEnd",d),n.removeEventListener("blur",a)}})(o,r,s);S.set(o,n)}if("date"!==r.type&&"datetime-local"!==r.type&&(s||c)&&w&&!M.has(o)){const n=((o,n,t,i,e,r,a,s=!1)=>{const c=r&&(void 0===a||a.mode===d.None),l=async()=>{v(o,n,t,i,e,c,s)};return o.addEventListener("focusin",l,!0),()=>{o.removeEventListener("focusin",l,!0)}})(o,r,s,c,f,y,g,l);M.set(o,n)}}};b&&(()=>{let o=!0,n=!1;const t=document;i(t,"ionScrollStart",(()=>{n=!0})),t.addEventListener("focusin",(()=>{o=!0}),!0),t.addEventListener("touchend",(i=>{if(n)return void(n=!1);const e=t.activeElement;if(!e)return;if(e.matches(p))return;const r=i.target;r!==e&&(r.matches(p)||r.closest(p)||(o=!1,setTimeout((()=>{o||e.blur()}),50)))}),!1)})();for(const o of h)D(o);r.addEventListener("ionInputDidLoad",(o=>{D(o.detail)})),r.addEventListener("ionInputDidUnload",(o=>{(o=>{if(m){const n=S.get(o);n&&n(),S.delete(o)}if(w){const n=M.get(o);n&&n(),M.delete(o)}})(o.detail)}))};export{S as startInputShims}