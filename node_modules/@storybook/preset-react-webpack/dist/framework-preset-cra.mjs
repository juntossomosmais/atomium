import{__require}from"./chunk-R4NKYYJA.mjs";import{logger as logger2}from"@storybook/node-logger";import fs from"fs";import path from"path";import semver from"semver";import{logger}from"@storybook/node-logger";var appDirectory=fs.realpathSync(process.cwd()),reactScriptsPath;function getReactScriptsPath({noCache}={}){if(reactScriptsPath&&!noCache)return reactScriptsPath;let reactScriptsScriptPath=fs.realpathSync(path.join(appDirectory,"/node_modules/.bin/react-scripts"));try{if(/node_modules[\\/]\.bin[\\/]react-scripts/i.test(reactScriptsScriptPath)){let packagePathMatch=fs.readFileSync(reactScriptsScriptPath,"utf8").match(/"\$basedir[\\/]([^\s]+?[\\/]bin[\\/]react-scripts\.js")/i);packagePathMatch&&packagePathMatch.length>1&&(reactScriptsScriptPath=path.join(appDirectory,"/node_modules/.bin/",packagePathMatch[1]))}}catch(e){logger.warn(`Error occurred during react-scripts package path resolving: ${e}`)}reactScriptsPath=path.join(reactScriptsScriptPath,"../..");let scriptsPkgJson=path.join(reactScriptsPath,"package.json");return fs.existsSync(scriptsPkgJson)||(reactScriptsPath="react-scripts"),reactScriptsPath}function isReactScriptsInstalled(requiredVersion="2.0.0"){try{let reactScriptsJson=__require(path.join(getReactScriptsPath(),"package.json"));return!semver.gtr(requiredVersion,reactScriptsJson.version)}catch{return!1}}var checkForNewPreset=presetsList=>{presetsList.some(preset=>{let presetName=typeof preset=="string"?preset:preset.name;return/@storybook(\/|\\)preset-create-react-app/.test(presetName)})||(logger2.warn("Storybook support for Create React App is now a separate preset."),logger2.warn("To use the new preset, install `@storybook/preset-create-react-app` and add it to the list of `addons` in your `.storybook/main.js` config file."),logger2.warn("The built-in preset has been disabled in Storybook 6.0."))},webpackFinal=(config,{presetsList})=>(isReactScriptsInstalled()&&presetsList&&checkForNewPreset(presetsList),config.module?.rules?.push({test:/\.m?js$/,type:"javascript/auto"},{test:/\.m?js$/,resolve:{fullySpecified:!1}}),config);export{webpackFinal};
