"use strict";var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(let key of __getOwnPropNames(from))!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod)),__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var framework_preset_cra_exports={};__export(framework_preset_cra_exports,{webpackFinal:()=>webpackFinal});module.exports=__toCommonJS(framework_preset_cra_exports);var import_node_logger2=require("@storybook/node-logger");var import_fs=__toESM(require("fs")),import_path=__toESM(require("path")),import_semver=__toESM(require("semver")),import_node_logger=require("@storybook/node-logger"),appDirectory=import_fs.default.realpathSync(process.cwd()),reactScriptsPath;function getReactScriptsPath({noCache}={}){if(reactScriptsPath&&!noCache)return reactScriptsPath;let reactScriptsScriptPath=import_fs.default.realpathSync(import_path.default.join(appDirectory,"/node_modules/.bin/react-scripts"));try{if(/node_modules[\\/]\.bin[\\/]react-scripts/i.test(reactScriptsScriptPath)){let packagePathMatch=import_fs.default.readFileSync(reactScriptsScriptPath,"utf8").match(/"\$basedir[\\/]([^\s]+?[\\/]bin[\\/]react-scripts\.js")/i);packagePathMatch&&packagePathMatch.length>1&&(reactScriptsScriptPath=import_path.default.join(appDirectory,"/node_modules/.bin/",packagePathMatch[1]))}}catch(e){import_node_logger.logger.warn(`Error occurred during react-scripts package path resolving: ${e}`)}reactScriptsPath=import_path.default.join(reactScriptsScriptPath,"../..");let scriptsPkgJson=import_path.default.join(reactScriptsPath,"package.json");return import_fs.default.existsSync(scriptsPkgJson)||(reactScriptsPath="react-scripts"),reactScriptsPath}function isReactScriptsInstalled(requiredVersion="2.0.0"){try{let reactScriptsJson=require(import_path.default.join(getReactScriptsPath(),"package.json"));return!import_semver.default.gtr(requiredVersion,reactScriptsJson.version)}catch{return!1}}var checkForNewPreset=presetsList=>{presetsList.some(preset=>{let presetName=typeof preset=="string"?preset:preset.name;return/@storybook(\/|\\)preset-create-react-app/.test(presetName)})||(import_node_logger2.logger.warn("Storybook support for Create React App is now a separate preset."),import_node_logger2.logger.warn("To use the new preset, install `@storybook/preset-create-react-app` and add it to the list of `addons` in your `.storybook/main.js` config file."),import_node_logger2.logger.warn("The built-in preset has been disabled in Storybook 6.0."))},webpackFinal=(config,{presetsList})=>{var _a,_b;return isReactScriptsInstalled()&&presetsList&&checkForNewPreset(presetsList),(_b=(_a=config.module)==null?void 0:_a.rules)==null||_b.push({test:/\.m?js$/,type:"javascript/auto"},{test:/\.m?js$/,resolve:{fullySpecified:!1}}),config};0&&(module.exports={webpackFinal});
