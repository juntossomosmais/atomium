import{d as A,w as m}from"./index-ZjP4CjeZ-C2-Wxc_X.js";import{f as O,g as k,c as F}from"./index-DVEJJPZQ-CCijrRKv.js";import{d as P,e as B,c as H,r as $}from"./helpers-53vrVRiL-LwcVLtj1.js";import{K as U,a as Y}from"./keyboard-DgiyREKb-CJJTAIJ7.js";import"./iframe-DRqdK8Tb.js";import"./capacitor-CG3xQUND-S5de6apY.js";import"./preload-helper-PPVm8Dsz.js";const D=new WeakMap,I=(e,o,t,s=0,r=!1)=>{D.has(e)!==t&&(t?G(e,o,s,r):W(e,o))},q=e=>e===e.getRootNode().activeElement,G=(e,o,t,s=!1)=>{const r=o.parentNode,n=o.cloneNode(!1);n.classList.add("cloned-input"),n.tabIndex=-1,s&&(n.disabled=!0),r.appendChild(n),D.set(e,n);const a=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",o.style.transform=`translate3d(${a}px,${t}px,0) scale(0)`},W=(e,o)=>{const t=D.get(e);t&&(D.delete(e),t.remove()),e.style.pointerEvents="",o.style.transform=""},N=50;const z=(e,o,t)=>{if(!t||!o)return()=>{};const s=a=>{q(o)&&I(e,o,a)},r=()=>I(e,o,!1),n=()=>s(!0),c=()=>s(!1);return P(t,"ionScrollStart",n),P(t,"ionScrollEnd",c),o.addEventListener("blur",r),()=>{B(t,"ionScrollStart",n),B(t,"ionScrollEnd",c),o.removeEventListener("blur",r)}};const T="input, textarea, [no-blur], [contenteditable]",j=()=>{let e=!0,o=!1;const t=document,s=()=>{o=!0},r=()=>{e=!0},n=c=>{if(o){o=!1;return}const a=t.activeElement;if(!a||a.matches(T))return;const f=c.target;f!==a&&(f.matches(T)||f.closest(T)||(e=!1,setTimeout(()=>{e||a.blur()},50)))};return P(t,"ionScrollStart",s),t.addEventListener("focusin",r,!0),t.addEventListener("touchend",n,!1),()=>{B(t,"ionScrollStart",s,!0),t.removeEventListener("focusin",r,!0),t.removeEventListener("touchend",n,!1)}};const J=.3,Q=(e,o,t,s)=>{var r;const n=(r=e.closest("ion-item,[ion-item]"))!==null&&r!==void 0?r:e;return V(n.getBoundingClientRect(),o.getBoundingClientRect(),t,s)},V=(e,o,t,s)=>{const r=e.top,n=e.bottom,c=o.top,a=Math.min(o.bottom,s-t),f=c+15,u=a-N-n,d=f-r,S=Math.round(u<0?-u:d>0?-d:0),v=Math.min(S,r-c),i=Math.abs(v)/J,y=Math.min(400,Math.max(150,i));return{scrollAmount:v,scrollDuration:y,scrollPadding:t,inputSafeY:-(r-f)+4}};const x="$ionPaddingTimer",M=(e,o,t)=>{const s=e[x];s&&clearTimeout(s),o>0?e.style.setProperty("--keyboard-offset",`${o}px`):e[x]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},R=(e,o,t)=>{const s=()=>{o&&M(o,0,t)};e.addEventListener("focusout",s,{once:!0})};let g=0;const K="data-ionic-skip-scroll-assist",X=(e,o,t,s,r,n,c,a=!1)=>{const f=n&&(c===void 0||c.mode===Y.None);let l=!1;const u=m!==void 0?m.innerHeight:0,d=b=>{if(l===!1){l=!0;return}_(e,o,t,s,b.detail.keyboardHeight,f,a,u,!1)},S=()=>{l=!1,m===null||m===void 0||m.removeEventListener("ionKeyboardDidShow",d),e.removeEventListener("focusout",S)},v=async()=>{if(o.hasAttribute(K)){o.removeAttribute(K);return}_(e,o,t,s,r,f,a,u),m===null||m===void 0||m.addEventListener("ionKeyboardDidShow",d),e.addEventListener("focusout",S)};return e.addEventListener("focusin",v),()=>{e.removeEventListener("focusin",v),m===null||m===void 0||m.removeEventListener("ionKeyboardDidShow",d),e.removeEventListener("focusout",S)}},C=e=>{var o;if(document.activeElement===e)return;const t=e.getAttribute("id"),s=e.closest(`label[for="${t}"]`),r=(o=document.activeElement)===null||o===void 0?void 0:o.closest(`label[for="${t}"]`);s!==null&&s===r||(e.setAttribute(K,"true"),e.focus())},_=async(e,o,t,s,r,n,c=!1,a=0,f=!0)=>{if(!t&&!s)return;const l=Q(e,t||s,r,a);if(t&&Math.abs(l.scrollAmount)<4){C(o),n&&t!==null&&(M(t,g),R(o,t,()=>g=0));return}if(I(e,o,!0,l.inputSafeY,c),C(o),$(()=>e.click()),n&&t&&(g=l.scrollPadding,M(t,g)),typeof window<"u"){let u;const d=async()=>{u!==void 0&&clearTimeout(u),window.removeEventListener("ionKeyboardDidShow",S),window.removeEventListener("ionKeyboardDidShow",d),t&&await F(t,0,l.scrollAmount,l.scrollDuration),I(e,o,!1,l.inputSafeY),C(o),n&&R(o,t,()=>g=0)},S=()=>{window.removeEventListener("ionKeyboardDidShow",S),window.addEventListener("ionKeyboardDidShow",d)};if(t){const v=await k(t),b=v.scrollHeight-v.clientHeight;if(f&&l.scrollAmount>b-v.scrollTop){o.type==="password"?(l.scrollAmount+=N,window.addEventListener("ionKeyboardDidShow",S)):window.addEventListener("ionKeyboardDidShow",d),u=setTimeout(d,1e3);return}}d()}};const Z=!0,ae=async(e,o)=>{if(A===void 0)return;const t=o==="ios",s=o==="android",r=e.getNumber("keyboardHeight",290),n=e.getBoolean("scrollAssist",!0),c=e.getBoolean("hideCaretOnScroll",t),a=e.getBoolean("inputBlurring",!1),f=e.getBoolean("scrollPadding",!0),l=Array.from(A.querySelectorAll("ion-input, ion-textarea")),u=new WeakMap,d=new WeakMap,S=await U.getResizeMode(),v=async i=>{await new Promise(L=>H(i,L));const y=i.shadowRoot||i,h=y.querySelector("input")||y.querySelector("textarea"),w=O(i),p=w?null:i.closest("ion-footer");if(!h)return;if(w&&c&&!u.has(i)){const L=z(i,h,w);u.set(i,L)}if(!(h.type==="date"||h.type==="datetime-local")&&(w||p)&&n&&!d.has(i)){const L=X(i,h,w,p,r,f,S,s);d.set(i,L)}},b=i=>{if(c){const y=u.get(i);y&&y(),u.delete(i)}if(n){const y=d.get(i);y&&y(),d.delete(i)}};a&&Z&&j();for(const i of l)v(i);A.addEventListener("ionInputDidLoad",i=>{v(i.detail)}),A.addEventListener("ionInputDidUnload",i=>{b(i.detail)})};export{ae as startInputShims};
