import{p as h,z as a,y as n,E as c,t as d,v as f,H as g,w as p}from"./iframe-D2cqz6gf.js";import{f as E,p as u,g as b}from"./index-DCKBj47w-fK0U7a2r.js";import"./preload-helper-PPVm8Dsz.js";import"./helpers-B-Uyga6H-C-IjF-5v.js";const m=()=>"ion-infinite-scroll{display:none;width:100%}.infinite-scroll-enabled{display:block}",H=class{constructor(s){h(this,s),this.ionInfinite=a(this,"ionInfinite",7),this.thrPx=0,this.thrPc=0,this.didFire=!1,this.isBusy=!1,this.isLoading=!1,this.threshold="15%",this.disabled=!1,this.position="bottom",this.onScroll=()=>{const t=this.scrollEl;if(!t||!this.canStart())return 1;const i=this.el.offsetHeight;if(i===0)return 2;const e=t.scrollTop,r=t.scrollHeight,l=t.offsetHeight,o=this.thrPc!==0?l*this.thrPc:this.thrPx;return(this.position==="bottom"?r-i-e-o-l:e-i-o)<0&&!this.didFire?(this.isLoading=!0,this.didFire=!0,this.ionInfinite.emit(),3):4}}thresholdChanged(){const s=this.threshold;s.lastIndexOf("%")>-1?(this.thrPx=0,this.thrPc=parseFloat(s)/100):(this.thrPx=parseFloat(s),this.thrPc=0)}disabledChanged(){const s=this.disabled;s&&(this.isLoading=!1,this.isBusy=!1),this.enableScrollEvents(!s)}async connectedCallback(){const s=E(this.el);if(!s){u(this.el);return}this.scrollEl=await b(s),this.thresholdChanged(),this.disabledChanged(),this.position==="top"&&n(()=>{this.scrollEl&&(this.scrollEl.scrollTop=this.scrollEl.scrollHeight-this.scrollEl.clientHeight)})}disconnectedCallback(){this.enableScrollEvents(!1),this.scrollEl=void 0}async complete(){const s=this.scrollEl;if(!(!this.isLoading||!s))if(this.isLoading=!1,this.position==="top"){this.isBusy=!0;const t=s.scrollHeight-s.scrollTop;requestAnimationFrame(()=>{c(()=>{const e=s.scrollHeight-t;requestAnimationFrame(()=>{n(()=>{s.scrollTop=e,this.isBusy=!1,this.didFire=!1})})})})}else this.didFire=!1}canStart(){return!this.disabled&&!this.isBusy&&!!this.scrollEl&&!this.isLoading}enableScrollEvents(s){this.scrollEl&&(s?this.scrollEl.addEventListener("scroll",this.onScroll):this.scrollEl.removeEventListener("scroll",this.onScroll))}render(){const s=d(this),t=this.disabled;return f(g,{key:"e844956795f69be33396ce4480aa7a54ad01b28c",class:{[s]:!0,"infinite-scroll-loading":this.isLoading,"infinite-scroll-enabled":!t}})}get el(){return p(this)}static get watchers(){return{threshold:[{thresholdChanged:0}],disabled:[{disabledChanged:0}]}}};H.style=m();export{H as ion_infinite_scroll};
